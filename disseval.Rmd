---
title: "Exploration of crab dissolution"
author: ""
output: 
  html_document:
    css: kable.css
self_contained: yes
runtime: shiny
---

```{r, message = F, warning = F, echo = F}
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE, dev.args = list(bg = 'transparent', family = 'serif'), eval = T, echo = F)

library(tidyverse)
library(shiny)

source('R/funcs.R')

data(dissdat)
data(lengdat)
```

```{r selectors}
column(12,
column(4, 
       
       selectInput('lng', 'Select length measure:', choices = unique(lengdat$lenvar))
       
       ),
column(4, 
       
       selectInput('dss', 'Select dissolution measure:', choices = unique(dissdat$distyp))
       
       )
)
```

```{r reactives}
# combined dissolution, length data to plot, model
disdat <- reactive({
  
  # input
  lng <- input$lng
  dss <- input$dss
  loc <- input$loc
  
  out <- inner_join(lengdat, dissdat, by = 'CTD') %>% 
    filter(lenvar %in% lng) %>% 
    filter(distyp %in% dss) 

  return(out)
  
})

# dissolution data plot
displo <- reactive({
  
  # input
  disdat <- disdat()
  
  # plot
  p <- ggplot(disdat, aes(x = disval, y = avelen)) +
    geom_point(aes(color = shoreloc), size = 4) + 
    geom_errorbar(aes(ymin = avelen - stelen, ymax = avelen + stelen, color = shoreloc), width = 0.1) +
    facet_grid(~prt) + 
    geom_smooth(method = 'lm', colour = 'black', se = F) + 
    geom_smooth(aes(group = shoreloc, linetype = shoreloc), colour = 'aquamarine3', se = F, method = 'lm') +
    theme_bw(base_family = 'serif', base_size = 16) +
    theme(
      legend.title = element_blank(),
      strip.background = element_blank(),
      legend.position = 'top'
      ) +
    scale_colour_manual(values = c('deepskyblue3', 'aquamarine3')) +
    ylab('Length') + 
    xlab('Dissolution') +
    scale_linetype_manual(values = c(0, 2))
  
  return(p)

})
```


```{r}
renderPlot({displo()}, height = 300, width = 900)
```

